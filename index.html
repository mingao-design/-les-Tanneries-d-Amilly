<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-analytics.js";
  import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";
  
  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyC7W5tJsaljaNmQ9QnlKZ22tCqnOGM2Ss0",
    authDomain: "livredor-10fb8.firebaseapp.com",
    projectId: "livredor-10fb8",
    storageBucket: "livredor-10fb8.firebasestorage.app",
    messagingSenderId: "835842642476",
    appId: "1:835842642476:web:f63a4ef791f7e1029b7789",
    measurementId: "G-CJ7ZWYN9Y4"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const db = getFirestore(app);

  const form = document.getElementById('message-form');
  const messagesContainer = document.getElementById('messages');

  // Firestore Query: Listen to messages in real time
  const q = query(collection(db, "messages"), orderBy("timestamp", "desc"));
  onSnapshot(q, (snapshot) => {
    messagesContainer.innerHTML = "";
    snapshot.forEach(doc => {
      const data = doc.data();
      const card = document.createElement('div');
      card.className = 'message-card';
      card.innerHTML = `<strong>${data.prenom}</strong><p>${data.message}</p>`;
      messagesContainer.appendChild(card);
    });
  });

  // Form submission: Save new messages to Firestore
  form.addEventListener('submit', async function(event) {
    event.preventDefault();
    const prenom = document.getElementById('prenom').value.trim();
    const message = document.getElementById('message').value.trim();

    if (prenom && message) {
      try {
        await addDoc(collection(db, "messages"), {
          prenom,
          message,
          timestamp: new Date()
        });
        form.reset(); // Clear the form after submission
      } catch (e) {
        alert("Erreur dâ€™enregistrement du message : " + e.message);
      }
    }
  });
</script>
